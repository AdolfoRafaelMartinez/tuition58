<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalshi Trade Bot</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="container" data-balance="<%= kalshi ? kalshi.balance : 0 %>">
        <h1>Tuition Bot</h1>
        <div id="clock"></div>
        <div class="section">
            <h2>Current Temperature</h2>
            <% if (current && current.temperature) { %>
                <p><strong>Temperature:</strong> <%= (current.temperature * 9/5 + 32).toFixed(2) %>°F</p>
            <% } else { %>
                <p>Current temperature not available.</p>
            <% } %>
        </div>
        <div class="section">
            <h2>Forecast</h2>
            <% if (weather) { %>
                <p><strong><%= weather.name %>:</strong> <%= weather.temperature %>°<%= weather.temperatureUnit %></p>
                <p><strong>Start Time:</strong> <%= new Date(weather.startTime).toLocaleString() %></p>
            <% } else { %>
                <p>Weather data not available.</p>
            <% } %>
        </div>
        <div class="section">
            <h2>Observed</h2>
            <% if (observed && observed.observation_max) { %>
                <p><%= observed.observation_max %> at <%= observed.observation_when %></p>
                <p>Reported at <%= observed.report_when %></p>
            <% } else if (observed && observed.error) { %>
                <p><%= observed.error %></p>
            <% } else { %>
                <p>Maximum temperature data not available.</p>
            <% } %>
        </div>
        <div class="section">
            <h2>Kalshi</h2>
            <% if (kalshi) { %>
                <p><strong>Balance:</strong> $<%= (kalshi.balance / 100).toFixed(2) %></p>
            <% } else { %>
                <p>Kalshi data not available.</p>
            <% } %>
        </div>
        <div class="section">
            <h2>Get Open Markets</h2>
            <form id="market-form">
                <label for="event-ticker">Event Ticker:</label>
                <input type="text" id="event-ticker" name="event-ticker" value="KXHIGHAUS-26JAN26" required>
                <button type="submit">Get Markets</button>
            </form>
            <div id="market-result"></div>
        </div>
        <div class="section">
            <h2>Place Orders</h2>
            <div id="order-forms-container"></div>
            <button id="place-all-orders" style="display:none;">Place All Orders</button>
            <div id="order-result"></div>
        </div>
        <div class="section">
            <h2>Positions</h2>
            <div id="positions-result"></div>
        </div>
    </div>
    <script src="/js/orderForm.js"></script>
    <script src="/js/marketForm.js"></script>
    <script>
        function updateClock() {
            const now = new Date();
            const clock = document.getElementById('clock');
            clock.textContent = now.toLocaleString();
        }
        setInterval(updateClock, 1000);
        updateClock();

        function generateAndDisplayTicker() {
            <% if (weather && weather.startTime) { %>
                const forecastDate = new Date('<%= weather.startTime %>');
                const year = forecastDate.getFullYear().toString().slice(-2);
                const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
                const month = months[forecastDate.getMonth()];
                const day = String(forecastDate.getDate()).padStart(2, '0');
                const dateString = `${year}${month}${day}`;
                const ticker = `KXHIGHAUS-${dateString}`;
                const eventTickerInput = document.getElementById('event-ticker');
                if (eventTickerInput) {
                    eventTickerInput.value = ticker;
                }
            <% } else { %>
                const now = new Date();
                const year = now.getFullYear().toString().slice(-2);
                const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
                const month = months[now.getMonth()];
                const day = String(now.getDate()).padStart(2, '0');
                const dateString = `${year}${month}${day}`;
                const ticker = `KXHIGHAUS-${dateString}`;
                const eventTickerInput = document.getElementById('event-ticker');
                if (eventTickerInput) {
                    eventTickerInput.value = ticker;
                }
            <% } %>
            // Fetch markets after ticker is generated
            if (window.fetchAndDisplayMarkets) {
                window.fetchAndDisplayMarkets();
            }
        }
        document.addEventListener('DOMContentLoaded', generateAndDisplayTicker);
    </script>
</body>
</html>